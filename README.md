# Stories profiler

Исследования лексики писателей-понифагов с использованием метода TF-IDF и текстового корпуса в 23 миллиона слов (207 крупнейших рассказов с ponyfiction.org)  

TF-IDF вычисляется для каждого слова по очень простой формуле TF x IDF, где:  
TF (Term Frequency) — частота слова в тексте, я взял просто количество повторений.  
IDF (Inverse Document Frequency) — величина, обратная количеству текстов, содержащих в себе это слово.  
Я взял log(N/n), где N — общее кол-во текстов в выборке, n — кол-во текстов, в которых есть это слово.  

## Установка

Скрипты проверялись только на GNU/Linux.  
`git clone https://github.com/Shadybloom/stories-profiler`  
Нужен питон третьей версии, например Python 3.7, а также sqlite3.  
`sudo apt-get update && sudo apt-get install python3.7 sqlite3`  
Кроме того понадобятся внешние библиотеки Python (можно установить в каталог пользователя):  
`pip install --user pymorphy2`  

## Подготовка общего словаря

Перейдём в каталог скрипта:  
`cd ./stories-profiler`  
Создадим рабочие каталоги:  
`mkdir ./fb2 ; mkdir ./txt`  
Рассказы в формате fb2 нужно перегнать в простой текст (очистить от тегов):  
`fb2-to-text.sh`  
Затем создаём по текстам списки слов (это займёт некоторое время):  
`text-to-wordfreq.sh`  
Создаём общий словарь:  
`wordfreq-compile.py > wordfreq-all.list`  

Транслит бесит. Сделай список с названиями файлов - названиями рассказов.  
Нужно будет извлечь их из тега <book-title> в fb2. Там же и авторы указаны, кстати.  

## Сравнение текста с общим словарём

Создадим рабочие каталоги:  
`mkdir ./stories`  
Создаём список слов из рассказа:  
`wordfreq-morph.py -m ./text-file.txt > ./stories/text-file.list`  
Преобразуем список по метоуд TF-IDF:  
`wordfreq-tf-idf.py ./stories/text-file.list > ./stories/text-file_tl-idf.list`

Формат таков:  
![Пример](/images/example.png)  

Слева направо (белые числа):  
1) Вес слова в формате TF-IDF.  
2) Частота слова в тексте.  
3) Число текстов с этим словом.  
4) Само слово.  
5) Рассказ, где слово встречается чаще всего.  

## Деаномизация автора по лексике

Можно использовать буфер обмена:  
`xclip -o | ./wordfreq-morph.py -m | ./wordfreq-tf-idf.py | ./wordfreq-search.py`  

![Попался](/images/catched.png)  

![Попался x2](/images/example2.png)  
